<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WEB BEKS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .chat-container {
      width: 500px;
      margin: 0 auto;
      padding: 30px;
      border: 1px solid #ccc;
    }

    #chat-display {
      height: 500px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      margin-bottom: 20px;
      padding: 10px;
    }

    #user-input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }
  </style>

  <div class="chat-container">
    <div id="chat-display"></div>
    <input type="text" id="user-input" placeholder="Type your message..." autofocus>
  </div>

  <script src="qa-library.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var input = document.getElementById('user-input');
      var display = document.getElementById('chat-display');
      var previousQuestions = []; // Keep track of previous questions
      var previousResponses = []; // Keep track of previous responses
      var repeatedWord = null; // Keep track of the repeated word

      input.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
          var message = input.value.trim(); // Remove leading/trailing spaces
          if (message !== '') { // Ignore empty messages
            displayMessage('You: ' + message);
            input.value = '';
            processMessage(message);
          }
        }
      });

      function displayMessage(message) {
        display.innerHTML += '<p>' + message + '</p>';
        display.scrollTop = display.scrollHeight;
      }

      function getRandomResponse(responses) {
        var randomIndex = Math.floor(Math.random() * responses.length);
        return responses[randomIndex];
      }

      function processMessage(message) {
        // Normalize user's message to remove diacritics and convert to lowercase
        var normalizedMessage = message.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

        // Check if the same question was asked before
        var index = previousQuestions.findIndex(q => q === normalizedMessage);
         if (index >= 0) {
            var response = 'Anonym: Neptal jsi se náhodou už na to?';
           displayMessage(response);
            return;
            }

        // Normalize questions in the question-answer library and compare
        for (var category in questionAnswerLibrary) {
          var questions = questionAnswerLibrary[category].questions;
         var answers = questionAnswerLibrary[category].answers;
          var matchingQuestion = questions.find(question => {
            
          // Normalize question and include the variation
          var normalizedQuestion = question.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
          return normalizedMessage.includes(normalizedQuestion) || normalizedQuestion.includes(normalizedMessage);
          });
          if (matchingQuestion) {
             var response = getRandomResponse(answers);
              displayMessage(response);
              // Save question and response for future use
              previousQuestions.push(normalizedMessage);
              previousResponses.push(response);
              return;
              }
          }

        // Default response
        var responses = [
          'Anonym: Česky prosím jakože umím ještě anglicky ale preferuji narodní jazyk.',
          'Anonym: Nejsem si uplně jistý co tím myslíš.🧐',
          'Anonym: Huh? nechápu 🤨'
          ];
       var response = getRandomResponse(responses);
       displayMessage(response);
}

    });
  </script>
</body>
</html>
